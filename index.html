<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Green Grocers Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/tone"></script>
  <style>
    /* Custom scrollbar for output */
    #output::-webkit-scrollbar {
      width: 8px;
    }
    #output::-webkit-scrollbar-track {
      background-color: #f1f5f9;
      border-radius: 4px;
    }
    #output::-webkit-scrollbar-thumb {
      background-color: #9ca3af;
      border-radius: 4px;
    }
    #output::-webkit-scrollbar-thumb:hover {
      background-color: #6b7280;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background-color: #f0fdf4;
      color: #15803d;
      padding: 16px;
      margin-bottom: 8px;
      border-left: 4px solid #16a34a;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      animation: slideIn 0.3s ease-out, slideOut 0.3s 2.5s ease-in forwards;
      opacity: 1;
      transition: opacity 0.3s ease-in-out;
    }
    .notification.warning {
      background-color: #fefce8;
      color: #854d0e;
      border-left-color: #fcd34d;
    }
    .notification.error {
      background-color: #fee2e2;
      color: #991b1b;
      border-left-color: #b91c1c;
    }
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
  </style>
</head>
<body class="bg-green-50 text-gray-800 font-sans">
  <div class="max-w-7xl mx-auto p-6 grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-green-600 col-span-3 mb-6">
      <h1 class="text-3xl font-bold mb-4 text-center text-green-700">Green Grocers</h1>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
        <div class="bg-green-100 p-4 rounded-lg shadow-sm hover:shadow-md transition duration-300">
          <h2 class="text-xl font-semibold text-green-700">Total Products</h2>
          <p id="totalProducts" class="text-2xl font-bold text-gray-800">0</p>
        </div>
        <div class="bg-orange-100 p-4 rounded-lg shadow-sm hover:shadow-md transition duration-300">
          <h2 class="text-xl font-semibold text-orange-700">Low Stock Items</h2>
          <p id="lowStockCount" class="text-2xl font-bold text-gray-800">0</p>
        </div>
        <div class="bg-yellow-100 p-4 rounded-lg shadow-sm hover:shadow-md transition duration-300">
          <h2 class="text-xl font-semibold text-yellow-700">Expiring Soon (7 Days)</h2>
          <p id="expiringSoonCount" class="text-2xl font-bold text-gray-800">0</p>
        </div>
      </div>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-blue-600">
      <h2 class="text-xl font-semibold mb-4 text-blue-800">Product Management</h2>
      <div class="mb-4">
        <input id="productId" placeholder="Product ID (for update/delete)" class="border-2 border-blue-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" />
      </div>
      <div class="grid grid-cols-1 gap-2 mb-4">
        <input id="productName" placeholder="Product Name" class="border-2 border-blue-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" />
        <input id="productQty" placeholder="Quantity" type="number" class="border-2 border-blue-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" />
        <input id="productPrice" placeholder="Price" type="number" step="0.01" class="border-2 border-blue-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" />
        <input id="expiryDate" placeholder="Expiry Date (YYYY-MM-DD)" type="date" class="border-2 border-blue-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" />
      </div>
      <div class="flex gap-2">
        <button onclick="addOrUpdateProduct()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded shadow-md transition duration-300 ease-in-out text-sm">Add/Update</button>
        <button onclick="deleteProduct()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded shadow-md transition duration-300 ease-in-out text-sm">Delete</button>
      </div>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-purple-600">
      <h2 class="text-xl font-semibold mb-4 text-purple-800">Record Sale</h2>
      <div class="grid grid-cols-1 gap-2 mb-4">
        <input id="saleProductId" placeholder="Product ID" class="border-2 border-purple-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm" />
        <input id="saleQty" placeholder="Quantity Sold" type="number" class="border-2 border-purple-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm" />
      </div>
      <button onclick="recordSale()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded shadow-md transition duration-300 ease-in-out text-sm">Record Sale</button>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-teal-600">
      <h2 class="text-xl font-semibold mb-4 text-teal-800">Stock Report</h2>
      <button onclick="showStock()" class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded shadow-md transition duration-300 ease-in-out text-sm w-full">View Full Stock</button>
      <div class="mt-4">
        <label for="searchStock" class="block text-gray-700 text-sm font-bold mb-2">Search Stock:</label>
        <input type="text" id="searchStock" onkeyup="searchTable('stockTable', this.value)" placeholder="Enter product name or ID" class="border-2 border-teal-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-teal-500 text-sm">
      </div>
      <div class="overflow-y-auto h-64 mt-2">
        <table id="stockTable" class="w-full text-sm">
          <thead>
            <tr class="bg-gray-100 text-gray-700">
              <th class="py-2 px-3 text-left">ID</th>
              <th class="py-2 px-3 text-left">Name</th>
              <th class="py-2 px-3 text-left">Qty</th>
              <th class="py-2 px-3 text-left">Price</th>
              <th class="py-2 px-3 text-left">Expiry</th>
            </tr>
          </thead>
          <tbody id="stockTableBody">
          </tbody>
        </table>
      </div>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-indigo-600 md:col-span-2">
      <h2 class="text-xl font-semibold mb-4 text-indigo-800">Sales Report</h2>
      <div class="mb-2">
        <button onclick="showSales('all')" class="bg-indigo-400 hover:bg-indigo-500 text-white px-3 py-1 rounded shadow-sm transition duration-300 ease-in-out text-sm mr-2">View All Sales</button>
        <button onclick="showSales('today')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded shadow-sm transition duration-300 ease-in-out text-sm">View Today's Sales</button>
      </div>
      <div class="mt-4">
        <label for="searchSales" class="block text-gray-700 text-sm font-bold mb-2">Search Sales (Product ID):</label>
        <input type="text" id="searchSales" onkeyup="searchTable('salesTable', this.value)" placeholder="Enter product ID" class="border-2 border-indigo-300 p-2 rounded w-full focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
      </div>
      <div class="overflow-y-auto h-[400px] mt-2">
        <table id="salesTable" class="w-full text-sm">
          <thead>
            <tr class="bg-gray-100 text-gray-700">
              <th class="py-2 px-3 text-left">Product ID</th>
              <th class="py-2 px-3 text-left">Name</th>
              <th class="py-2 px-3 text-left">Quantity</th>
              <th class="py-2 px-3 text-left">Date</th>
              <th class="py-2 px-3 text-left">Remaining Stock</th>
            </tr>
          </thead>
          <tbody id="salesTableBody">
          </tbody>
        </table>
      </div>
    </div>
    <div class="bg-yellow-100 p-6 rounded-lg shadow-md border-l-4 border-yellow-600">
      <h2 class="text-xl font-semibold mb-4 text-yellow-800">Alerts</h2>
      <div id="expiryAlerts" class="mb-4">
        <h3 class="text-lg font-semibold text-yellow-700 mb-2">Expiry (Next 7 Days)</h3>
        <ul id="alertList" class="list-disc pl-6 text-yellow-800 text-sm"></ul>
        <p id="noExpiryAlerts" class="text-sm text-gray-600 italic hidden">No products expiring soon.</p>
      </div>
      <div id="lowStockAlerts">
        <h3 class="text-lg font-semibold text-red-700 mb-2">Low Stock</h3>
        <ul id="lowStockList" class="list-disc pl-6 text-red-800 text-sm"></ul>
        <p id="noLowStockAlerts" class="text-sm text-gray-600 italic hidden">All products are in sufficient stock.</p>
      </div>
    </div>
    <div class="bg-gray-100 p-4 rounded-lg shadow-md col-span-3">
      <h2 class="text-lg font-semibold mb-2 text-gray-700">System Messages</h2>
      <pre id="output" class="text-sm font-mono text-gray-800 h-32 overflow-y-auto whitespace-pre-wrap"></pre>
    </div>
  </div>
  <script>
    let products = JSON.parse(localStorage.getItem('products')) || [];
    let sales = JSON.parse(localStorage.getItem('sales')) || [];
    const synth = new Tone.Synth().toDestination();
    function saveData() {
      localStorage.setItem('products', JSON.stringify(products));
      localStorage.setItem('sales', JSON.stringify(sales));
    }
    function generateProductId() {
      return Math.random().toString(36).substring(2, 15);
    }
    function addOrUpdateProduct() {
      const id = document.getElementById("productId").value.trim();
      const name = document.getElementById("productName").value.trim();
      const qty = parseInt(document.getElementById("productQty").value);
      const price = parseFloat(document.getElementById("productPrice").value);
      const expiry = document.getElementById("expiryDate").value;
      if (!name || isNaN(qty) || isNaN(price) || !expiry) {
        showOutput("‚ö†Ô∏è Please fill all product details correctly.");
        showNotification('error', 'Please fill all product details correctly.');
        return;
      }
      const productData = { name, qty, price, expiry };
      if (id) {
        const index = products.findIndex(p => p.id === id);
        if (index !== -1) {
          products[index] = { id, ...productData };
          showOutput(`‚úÖ Updated product: ${name} (ID: ${id})`);
          showNotification('success', `Updated product: ${name} (ID: ${id})`);
        } else {
          const newId = generateProductId();
          products.push({ id: newId, ...productData });
          showOutput(`‚úÖ Added new product: ${name} (ID: ${newId})`);
          showNotification('success', `Added new product: ${name} (ID: ${newId})`);
        }
      } else {
        const newId = generateProductId();
        products.push({ id: newId, ...productData });
        showOutput(`‚úÖ Added new product: ${name} (ID: ${newId})`);
        showNotification('success', `Added new product: ${name} (ID: ${newId})`);
      }
      clearProductForm();
      saveData();
      updateDashboard();
      updateAlerts();
    }
    function deleteProduct() {
      const idToDelete = document.getElementById("productId").value.trim();
      if (!idToDelete) {
        showOutput("‚ö†Ô∏è Please enter the Product ID to delete.");
        showNotification('error', 'Please enter the Product ID to delete.');
        return;
      }
      const initialLength = products.length;
      const productIndex = products.findIndex(p => p.id === idToDelete);
      if (productIndex !== -1) {
        products.splice(productIndex, 1);
        showOutput(`üóëÔ∏è Deleted product with ID: ${idToDelete}`);
        showNotification('success', `Deleted product with ID: ${idToDelete}`);
        clearProductForm();
        saveData();
        updateDashboard();
        updateAlerts();
      } else {
        showOutput(`‚ùå Product with ID: ${idToDelete} not found.`);
        showNotification('error', `Product with ID: ${idToDelete} not found.`);
      }
    }
    function recordSale() {
      const id = document.getElementById("saleProductId").value.trim();
      const qtySold = parseInt(document.getElementById("saleQty").value);
      if (isNaN(qtySold) || qtySold <= 0) {
        showOutput("‚ö†Ô∏è Please enter a valid quantity to sell.");
        showNotification('error', 'Please enter a valid quantity to sell.');
        return;
      }
      const productIndex = products.findIndex(p => p.id === id);
      if (productIndex === -1) {
        showOutput(`‚ùå Product with ID: ${id} not found.`);
        showNotification('error', `Product with ID: ${id} not found.`);
        return;
      }
      const product = products[productIndex];
      if (product.qty < qtySold) {
        showOutput(`‚ùå Insufficient stock for ${product.name}. Available: ${product.qty}`);
        showNotification('error', `Insufficient stock for ${product.name}. Available: ${product.qty}`);
        return;
      }
      // Update stock level
      products[productIndex].qty -= qtySold;
      // Record the sale
      const sale = {
        productId: id,
        productName: product.name,
        quantity: qtySold,
        saleDate: new Date().toISOString(),
      };
      sales.push(sale);
      showOutput(`üí∞ Sold ${qtySold} of ${product.name} (ID: ${id})`);
      showNotification('success', `Sold ${qtySold} of ${product.name} (ID: ${id})`);
      clearSaleForm();
      saveData();
      updateDashboard();
      updateAlerts();
      displayTodaysSales(); // Call this function after recording a sale
    }
    function showStock() {
      const stockTableBody = document.getElementById("stockTableBody");
      stockTableBody.innerHTML = '';
      products.forEach(p => {
        const row = stockTableBody.insertRow();
        row.insertCell().textContent = p.id;
        row.insertCell().textContent = p.name;
        row.insertCell().textContent = p.qty;
        row.insertCell().textContent = `$${p.price.toFixed(2)}`;
        row.insertCell().textContent = p.expiry;
      });
    }
    function showSales(filter = 'all') {
      const salesTableBody = document.getElementById("salesTableBody");
      salesTableBody.innerHTML = '';
      const today = new Date().toISOString().split("T")[0];
      const salesToDisplay = sales.filter(sale => {
        if (filter === 'today') {
          return sale.saleDate.split("T")[0] === today;
        }
        return true; // Show all sales if filter is not 'today'
      });
      salesToDisplay.forEach(s => {
        const product = products.find(p => p.id === s.productId);
        const row = salesTableBody.insertRow();
        row.insertCell().textContent = s.productId;
        row.insertCell().textContent = s.productName;
        row.insertCell().textContent = s.quantity;
        row.insertCell().textContent = new Date(s.saleDate).toLocaleDateString();
        row.insertCell().textContent = product ? product.qty : 'N/A'; // Show current stock
      });
    }
    function showOutput(message) {
      const outputElement = document.getElementById("output");
      outputElement.textContent += message + "\n";
      outputElement.scrollTop = outputElement.scrollHeight;
    }
    function clearProductForm() {
      document.getElementById("productId").value = '';
      document.getElementById("productName").value = '';
      document.getElementById("productQty").value = '';
      document.getElementById("productPrice").value = '';
      document.getElementById("expiryDate").value = '';
    }
    function clearSaleForm() {
      document.getElementById("saleProductId").value = '';
      document.getElementById("saleQty").value = '';
    }
    function updateAlerts() {
      const alertList = document.getElementById("alertList");
      const lowStockList = document.getElementById("lowStockList");
      const expiringSoonCountElement = document.getElementById("expiringSoonCount");
      const lowStockCountElement = document.getElementById("lowStockCount");
      const noExpiryAlertsElement = document.getElementById("noExpiryAlerts");
      alertList.innerHTML = '';
      lowStockList.innerHTML = '';
      let expiringSoonCount = 0;
      let lowStockCount = 0;
      const today = new Date();
      const sevenDaysLater = new Date(today);
      sevenDaysLater.setDate(today.getDate() + 7);
      products.forEach(p => {
        const expiryDate = new Date(p.expiry);
        const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 3600 * 24));
        if (daysUntilExpiry <= 7 && daysUntilExpiry >= 0) {
          const li = document.createElement("li");
          li.textContent = `${p.name} expires in ${daysUntilExpiry} days`;
          alertList.appendChild(li);
          expiringSoonCount++;
          showNotification('warning', `${p.name} expires in ${daysUntilExpiry} days`);
          playSound('warning');
        }
        if (p.qty <= 5) {
          const li = document.createElement("li");
          li.textContent = `${p.name} is running low on stock! (Current: ${p.qty})`;
          lowStockList.appendChild(li);
          lowStockCount++;
          showNotification('error', `${p.name} is running low on stock! (Current: ${p.qty})`);
          playSound('error');
        }
      });
      expiringSoonCountElement.textContent = expiringSoonCount;
      lowStockCountElement.textContent = lowStockCount;
      noExpiryAlertsElement.classList.toggle('hidden', expiringSoonCount > 0);
      noLowStockAlertsElement.classList.toggle('hidden', lowStockCount > 0);
      displayTodaysSales(); // Keep this here to update on the interval as well
    }
    function searchTable(tableId, input) {
      let filter = input.toUpperCase();
      let table = document.getElementById(tableId);
      let tr = table.getElementsByTagName("tr");
      for (let i = 0; i < tr.length; i++) {
        let td = tr[i].getElementsByTagName("td")[0];
        if (td) {
          let textValue = td.textContent || td.innerText;
          if (textValue.toUpperCase().indexOf(filter) > -1) {
            tr[i].style.display = "";
          } else {
            tr[i].style.display = "none";
          }
        }
      }
    }
    function updateDashboard() {
      document.getElementById("totalProducts").textContent = products.length;
      document.getElementById("lowStockCount").textContent = products.filter(p => p.qty <= 5).length;
      document.getElementById("expiringSoonCount").textContent = products.filter(p => {
        const expiryDate = new Date(p.expiry);
        const today = new Date();
        const diffDays = (expiryDate - today) / (1000 * 3600 * 24);
        return diffDays <= 7 && diffDays >= 0;
      }).length;
      showStock();
      showSales(); // This will now show all sales by default
    }
    function showNotification(type, message) {
      const notification = document.createElement('div');
      notification.classList.add('notification');
      notification.classList.add(type);
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }
    function playSound(type) {
      if (type === 'warning') {
        synth.triggerAttackRelease("C4", "8n");
      } else if (type === 'error') {
        synth.triggerAttackRelease("A2", "8n");
      }
    }
    function displayTodaysSales() {
        const today = new Date().toISOString().split("T")[0];
        const todaysSales = sales.filter(sale => sale.saleDate.split("T")[0] === today);
        const todaysSalesTableBody = document.getElementById("todaysSalesTableBody");
        const dailySalesList = document.getElementById("dailySalesList"); // Get the UL element
        const noDailySalesElement = document.getElementById("noDailySales");
        todaysSalesTableBody.innerHTML = '';
        dailySalesList.innerHTML = ''; // Clear the list each time
        let totalSalesToday = 0;
        if (todaysSales.length === 0) {
            noDailySalesElement.classList.remove('hidden');
            showOutput(`No sales recorded today.`);
            const listItem = document.createElement('li');
            listItem.textContent = 'No sales recorded today.';
            dailySalesList.appendChild(listItem);
        } else {
            noDailySalesElement.classList.add('hidden');
            todaysSales.forEach(sale => {
                const product = products.find(p => p.id === sale.productId);
                if (product) {
                    const row = todaysSalesTableBody.insertRow();
                    row.insertCell().textContent = sale.productId;
                    row.insertCell().textContent = sale.productName;
                    row.insertCell().textContent = sale.quantity;
                    row.insertCell().textContent = product.qty;
                    row.insertCell().textContent = product.expiry;
                    totalSalesToday += sale.quantity;
                    // Add a simple list item for the summary list
                    const listItem = document.createElement('li');
                    listItem.textContent = `${sale.productName}: ${sale.quantity} sold`;
                    dailySalesList.appendChild(listItem);
                }
            });
            showOutput(`Total sales today: ${totalSalesToday}`);
        }
    }
    updateDashboard();
    updateAlerts();
    setInterval(updateAlerts, 60000);
  </script>
</body>
</html>
